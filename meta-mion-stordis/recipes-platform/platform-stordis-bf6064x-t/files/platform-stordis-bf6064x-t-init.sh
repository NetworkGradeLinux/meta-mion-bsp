#!/bin/sh

# SPDX-License-Identifier: MIT 

function enable_tx() {
	# Set Module TX-Disable Registers
	i2cset -y 0 0x70 0x20
	i2cset -y 0 0x32 0xE 0x0
	i2cset -y 0 0x32 0xF 0x0
	i2cset -y 0 0x34 0x2 0x0
	i2cset -y 0 0x34 0x3 0x0
	i2cset -y 0 0x34 0x4 0x0
	i2cset -y 0 0x35 0x2 0x0
	i2cset -y 0 0x35 0x3 0x0
	i2cset -y 0 0x35 0x4 0x0
	i2cset -y 0 0x70 0x20
	i2cset -y 0 0x32 0x14 0xff
	i2cset -y 0 0x32 0x15 0xff
	i2cset -y 0 0x34 0xB 0xff
	i2cset -y 0 0x34 0xC 0xff
	i2cset -y 0 0x34 0xD 0xff
	i2cset -y 0 0x35 0xB 0xff
	i2cset -y 0 0x35 0xC 0xff
	i2cset -y 0 0x35 0xD 0xff
}

function wait_for_file() {
	FILE=$1
	i=0
	while [ $i -lt 10 ]; do
		test -e $FILE && return 0
		i=$(( i + 1 ))
		sleep 1
	done
	return 1
}

wait_for_file /sys/bus/i2c/devices/i2c-0 && enable_tx
